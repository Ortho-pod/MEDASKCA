<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Request access • MEDASKCA</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Poppins:wght@700;800&display=swap" rel="stylesheet">

  <style>
    /* ---- Theme matches your homepage ---- */
    :root{
      --bg:#0b0d10;
      --surface:#0e1116;
      --text:#eaf0f6;
      --muted:#b9c4d2;
      --muted-strong:#d7dee9;
      --line:#1e2430;
      --teal:#14b8a6;
      --blue:#3b82f6;
      --accent-grad:linear-gradient(135deg,var(--teal),var(--blue));
      --shadow:0 14px 30px rgba(0,0,0,.45);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text); background:var(--bg);
      font:15px/1.55 Inter,system-ui,Segoe UI,Roboto,Arial;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      overflow-x:hidden;
    }

    /* ---- Animated background ---- */
    .bg{
      position:fixed; inset:-20% -10% -10% -10%; z-index:-1; filter:blur(40px);
      background:
        radial-gradient(600px 320px at 15% 10%, rgba(20,184,166,.28), transparent 60%),
        radial-gradient(560px 360px at 85% 15%, rgba(59,130,246,.24), transparent 60%),
        radial-gradient(520px 320px at 50% 90%, rgba(20,184,166,.22), transparent 60%);
      animation:bgMove 18s ease-in-out infinite alternate;
    }
    @keyframes bgMove{
      0%{transform:translate3d(0,0,0) scale(1)}
      100%{transform:translate3d(0,-2%,0) scale(1.03)}
    }

    /* ---- Layout ---- */
    .wrap{max-width:760px;margin:48px auto;padding:0 16px}
    header{
      display:flex; align-items:center; gap:14px; margin-bottom:18px;
    }
    .logo{
      width:44px;height:44px;border-radius:12px;overflow:hidden;flex:0 0 44px;
      box-shadow:var(--shadow); background:#0c1219;
    }
    .logo img{width:100%;height:100%;object-fit:contain;display:block}
    h1{
      font:800 clamp(28px,4vw,40px)/1.08 Poppins,Inter;
      margin:0; letter-spacing:-.02em;
      background:var(--accent-grad); -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .lead{color:var(--muted); margin:8px 0 20px}

    .card{
      background:linear-gradient(180deg, var(--surface), #0c1219);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px;
    }

    form{display:grid;gap:14px}
    label{font-weight:600;color:var(--muted-strong);font-size:13px}
    .row{display:grid;gap:14px;grid-template-columns:1fr}
    @media (min-width:720px){ .row{grid-template-columns:1fr 1fr} }

    input,textarea,button{
      width:100%; font:inherit; color:var(--text);
      padding:12px 14px; border-radius:12px; border:1px solid #202532;
      background:#0c1219; outline:none; transition:box-shadow .15s,border-color .15s,background .15s;
    }
    input:focus,textarea:focus{box-shadow:0 0 0 4px rgba(79,124,255,.18); border-color:#2b61ff}
    textarea{min-height:100px; resize:vertical}

    .submit{
      background:var(--accent-grad); color:#061018; font-weight:800; letter-spacing:.2px; cursor:pointer; border:0;
      display:flex; align-items:center; justify-content:center; gap:10px;
    }
    .submit[disabled]{opacity:.7; cursor:progress}

    .meta{display:flex;justify-content:space-between;gap:10px;color:var(--muted);font-size:13px;margin-top:12px;flex-wrap:wrap}
    .meta a{color:var(--teal);text-decoration:none}
    .meta a:hover{text-decoration:underline}

    .alert{display:none;margin-top:10px;padding:12px 14px;border-radius:12px;font-size:14px;border:1px solid}
    .alert.ok{background:rgba(20,184,166,.12);border-color:rgba(20,184,166,.4)}
    .alert.error{background:rgba(255,107,107,.12);border-color:rgba(255,107,107,.4)}

  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>

  <main class="wrap">
    <header>
      <div class="logo"><img src="../logo-medaskca.png" alt="MEDASKCA logo"></div>
      <div>
        <h1>Request access</h1>
        <p class="lead">Tell us who you are and we’ll email a secure link after approval.</p>
      </div>
    </header>

    <section class="card" aria-label="Access request form">
      <form id="reg" novalidate>
        <div class="row">
          <div>
            <label for="name">Full name</label>
            <input id="name" name="name" placeholder="Your name" autocomplete="name" required />
          </div>
          <div>
            <label for="email">Work email</label>
            <input id="email" name="email" type="email" placeholder="you@company.com" autocomplete="email" required />
          </div>
        </div>

        <div>
          <label for="org">Organisation (optional)</label>
          <input id="org" name="organisation" placeholder="e.g., Trust / Department / Company" />
        </div>

        <div>
          <label for="notes">Context (optional)</label>
          <textarea id="notes" name="notes" placeholder="Brief context helps us route your request."></textarea>
        </div>

        <button class="submit" id="submitBtn" type="submit">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 12h12m0 0-4-4m4 4-4 4M21 3v18" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Request access
        </button>

        <div id="msg" class="alert" role="status" aria-live="polite"></div>

        <div class="meta">
          <span>Questions? <a href="mailto:registrations@medaskca.com">registrations@medaskca.com</a></span>
          <a href="/">Back to home</a>
        </div>
      </form>
    </section>
  </main>

  <script>
    // Primary API (same-origin) and safe fallback to your Worker
    const API_PRIMARY = "/api/register";
    const API_FALLBACK = "https://medaskca-preview.medaskca.workers.dev/api/register"; // keep if routes aren’t attached yet

    const form = document.getElementById('reg');
    const msg  = document.getElementById('msg');
    const btn  = document.getElementById('submitBtn');

    function show(kind, text){
      msg.className = "alert " + (kind === "error" ? "error" : "ok");
      msg.textContent = text;
      msg.style.display = "block";
    }

    async function postJSON(url, payload){
      return fetch(url, {
        method: "POST",
        headers: { "content-type": "application/json" },
        body: JSON.stringify(payload),
      });
    }

    async function send(payload){
      // Try same-origin first
      let r = await postJSON(API_PRIMARY, payload);
      if (r.ok) return r;
      if ([404,405].includes(r.status)) {
        // Pages 404/405 → route not intercepting, use workers.dev
        r = await postJSON(API_FALLBACK, payload);
        if (r.ok) return r;
      }
      const t = await r.text().catch(()=> "");
      throw new Error(t || ("HTTP " + r.status));
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.style.display = "none";

      const name  = form.name.value.trim();
      const email = form.email.value.trim().toLowerCase();
      if(!name || !email){ show("error", "Please enter your name and a valid email."); return; }

      const payload = {
        name, email,
        organisation: form.organisation.value.trim(),
        notes: (document.getElementById('notes').value || "").trim()
      };

      btn.disabled = true; btn.textContent = "Submitting…";
      try{
        await send(payload);
        show("ok", "Thanks! We’ll email you a link after approval.");
        form.reset();
      }catch(err){
        show("error", "Something went wrong: " + err.message);
      }finally{
        btn.disabled = false; btn.textContent = "Request access";
      }
    });
  </script>

  <noscript><p style="padding:24px;color:#b9c4d2">Please enable JavaScript to submit this form.</p></noscript>
</body>
</html>
